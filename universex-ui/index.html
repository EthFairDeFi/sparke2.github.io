<!-- <pre style="width: 100%; height: 100%; margin:0px; "></pre> -->

<div id="header_txt" style="width: 30%; height: 5%; padding-bottom: 10px;"> Author & C++: <a href="https://github.com/Dexaran/">@Dexaran</a> (dexaran@ethereumclassic.org) <br> UI: <a href="https://github.com/Sparke2/">@Sparke2</a> (ligreat875@gmail.com) </div>
<button id="switch_to_grid_btn" style="margin-left: 15%; margin-top: -25px; position: absolute;" onclick="initGridView()"> Switch to grid view </button>
<button id="switch_to_text_btn" style="margin-left: 15%; margin-top: -25px; position: absolute;" onclick="initTextView()"> Switch to sector list </button>
<p id="player_name_description" style="margin-left: 25%; margin-top: -42px; position: absolute;"> Player name: </p>
<input id="player_name_input" type="text" name="player_name" onchange="updatePlayerName()" style="margin-left: 25%; margin-top: -25px; position: absolute;" value="dexaraniiznx">
<div id="player_exists" style="display: none;">false</div>

<div style="margin-left: 40%; margin-top: -45px; position: absolute; font-size: 31;"> Universe X <a href="https://eos.io/">EOSIO</a> smart-contract UI</div>


<!--- PLANETARY MODE SCREEN -->
  <div id="planetScreen" class="planetmode" style="width: 70%; height: 80%; background-color: #E2E2E2; position: fixed; margin-left: 10%; margin-top: 0%; display: none;">


    <div id="planet_upper_bar" class="itemholder" style="margin-left: 1%; margin-top: 1%; width: 98%; height: 6%; position: absolute;">
      <p id="planet_description" style="margin-left: 1%; margin-top: 0%; position: absolute;">Planet ID:  </p>
      <p id="planet_position_xy" style="margin-left: 11%; margin-top: 0%; position: absolute;"></p>
      <p id="planet_update_text" style="margin-left: 1%; margin-top: 2%; position: absolute;">Updated: </p>
      <p id="planet_update" style="margin-left: 6%; margin-top: 2%; position: absolute;"></p>
      <p id="planet_owner_text" style="margin-left: 11%; margin-top: 2%; position: absolute;">Owner: </p>
      <p id="planet_owner_name" style="margin-left: 15%; margin-top: 2%; position: absolute;"></p>
      <button style="margin-left: 98%; margin-top: 0%; position: absolute;" onclick="hideAllPlanets()"> X </button>
    </div>

    <div id="buildings" class="itemholder" style="width: 72%; height: 30%; margin-left: 2%; margin-top: 40%; position: absolute; display: none;">
        <div id="buildings_tab_name" style="font-size: 22;">Planetary Landscape and buildings</div> 

      <div id="metal_mine" class="outset" onclick="showBuildingOverlay(3)" style="margin-left: 3%; margin-top: 1%; height: 28%; width: 8%; position: absolute;">Metal Mine
        <div id="metal_mine_lvl" style="display: none;"></div>
      </div> 
      <div id="crystal_mine" class="outset" onclick="showBuildingOverlay(4)" style="margin-left: 13%; margin-top: 1%; height: 28%; width: 8%; position: absolute;">Crystal Mine
        <div id="crystal_mine_lvl" style="display: none;"></div>
      </div> 
      <div id="gas_mine" class="outset" onclick="showBuildingOverlay(5)" style="margin-left: 23%; margin-top: 1%; height: 28%; width: 8%; position: absolute;">Gas Mine
        <div id="gas_mine_lvl" style="display: none;"></div>
      </div> 

      <div id="metal_storage" class="outset" onclick="showBuildingOverlay(6)" style="margin-left: 3%; margin-top: 12%; height: 28%; width: 8%; position: absolute;">Metal Storage
        <div id="metal_storage_lvl" style="display: none;"></div>
      </div> 
      <div id="crystal_storage" class="outset" onclick="showBuildingOverlay(7)" style="margin-left: 13%; margin-top: 12%; height: 28%; width: 8%; position: absolute;">Crystal Storage
        <div id="crystal_storage_lvl" style="display: none;"></div>
      </div> 
      <div id="gas_storage" class="outset" onclick="showBuildingOverlay(8)" style="margin-left: 23%; margin-top: 12%; height: 28%; width: 8%; position: absolute;">Gas Storage
        <div id="gas_storage_lvl" style="display: none;"></div>
      </div> 

      <div id="com_center" class="outset" onclick="showBuildingOverlay(0)" style="margin-left: 45%; margin-top: 12%; height: 28%; width: 8%; position: absolute;">Com. Center
        <div id="com_center_lvl" style="display: none;"></div>
      </div> 
      <div id="assembly" class="outset" onclick="showBuildingOverlay(1)" style="margin-left: 35%; margin-top: 12%; height: 28%; width: 8%; position: absolute;">Assembly
        <div id="assembly_lvl" style="display: none;"></div>
      </div> 
      <div id="shield" class="outset" onclick="showBuildingOverlay(2)" style="margin-left: 55%; margin-top: 12%; height: 28%; width: 8%; position: absolute;">Shield
        <div id="shield_lvl" style="display: none;"></div>
      </div> 

  </div>

    <div id="actions" class="itemholder" style="width: 22%; height: 30%; margin-left: 75%; margin-top: 40%; position: absolute; display: none;">

        <div id="actions_tab_name" style="font-size: 22;">Planetary actions</div> 
      <button style="margin-left: 15%; margin-top: 5%; width: 70%; height: 13%; position: absolute;" onclick="showSendFleetMenu()"> Send Fleets Here </button>
      <button style="margin-left: 15%; margin-top: 45%; width: 70%; height: 13%; position: absolute;" disabled="true"> Issue planetary order </button>
      <button style="margin-left: 15%; margin-top: 25%; width: 70%; height: 13%; position: absolute;" disabled="true"> Abandon planet </button>
    </div>
    <div id="fleets" class="fleetlist" style="width: 22%; height: 40%; margin-left: 75%; margin-top: 7%; position: absolute; display: none;">
      
        <div id="fleets_tab_name" style="font-size: 22;">Active fleets and fleet orders</div> 
    </div>
    <div id="deco_landscape" class="itemholder" style="width: 72%; height: 54%; margin-left: 2%; margin-top: 7%; position: absolute;">

    <div id="cell_name" style="margin-left: 10%; margin-top: 2%; position: absolute; "> Undefined building</div>
    <div id="cell_building_level" style="margin-left: 10%; margin-top: 5%; position: absolute; ">Lvl: -</div>
    <div id="cell_description" style="margin-left: 10%; margin-top: 8%; position: absolute; "> Does nothing </div>


    <div id="resources_bar" class="sendfleetmenu" style="margin-left: -0.2%; margin-top: 41%; height: 7%; width: 99.8%; position: absolute; ">

      <div style="margin-left: 10%; margin-top: 1%; position: absolute; font-size: 17; color: #FFFFFF;">Metal: </div>
      <div id="planetary_metal_res" style="margin-left: 15%; margin-top: 1%; position: absolute; font-size: 17; color: #FFFFFF;"></div>

      <div style="margin-left: 24%; margin-top: 1%; position: absolute; font-size: 17; color: #FFFFFF;">Crystal: </div>
      <div id="planetary_crystal_res" style="margin-left: 30%; margin-top: 1%; position: absolute; font-size: 17; color: #FFFFFF;"></div>

      <div style="margin-left: 41.3%; margin-top: 1%; position: absolute; font-size: 17; color: #FFFFFF;">Gas: </div>
      <div id="planetary_gas_res" style="margin-left: 45%; margin-top: 1%; position: absolute; font-size: 17; color: #FFFFFF;"></div>
    </div>

    <button id="cell_build_btn" onclick="addTaskBuild()" style="margin-left: 0%; margin-top: 37%; height: 7%; width: 10%; position: absolute; display: none;"> BUILD </button>
    <button id="cell_upgrade_btn" onclick="addTaskBuild()" style="margin-left: 0%; margin-top: 37%; height: 7%; width: 10%;  position: absolute; display: none;"> UPGRADE </button>

      <button id="spawn_btn" style="margin-left: 10%; margin-top: 15%; width: 80%; height: 15%; position: absolute; display: none;" onclick="spawnPlayer()"> Spawn Here </button>
      
    </div>
<!--    ------------------------- -->




<!--- SEND FLEET POPUP MENU -->
<div id="sendFleetMenu" class="sendfleetmenu" style="width: 45%; height: 30%; position: fixed; margin-left: 5%; margin-top: 7%; display: none;">


<p style="position: fixed; margin-left: 1%; margin-top: 1%; font-size: 20; color: #FFFFFF;">From: </p>

    <select id="planet_select" onchange="showPlanetFleets()" style="position: fixed; margin-left: 5%; margin-top: 1%; width: 10%; height: 3%;">
      <option value="">chose owned planet</option>
    </select>

<p style="position: fixed; margin-left: 27%; margin-top: 1%; font-size: 20; color: #FFFFFF;">Order: </p>

    <select id="order_select" onchange="checkAllowedCargo()" style="position: fixed; margin-left: 30%; margin-top: 1%; width: 10%; height: 3%;">
      <option value="2">Attack</option>
      <option value="3">Transport</option>
      <option value="4">Move</option>
      <option value="5">Colonize</option>
    </select>

<p style="position: fixed; margin-left: 17%; margin-top: 1%; font-size: 20; color: #FFFFFF;">To: </p>
<p id="fleet_send_destination" style="position: fixed; margin-left: 19%; margin-top: 1%; font-size: 20; color: #FFFFFF;">planet</p>


<div style="position: fixed; margin-left: 4%; margin-top: 3%; font-size: 22; color: #FFFFFF;">Ships</div>

<div id="battleships_textholder" style="position: fixed; margin-left: 1%; margin-top: 5%; font-size: 17; color: #FFFFFF;">Battleships:</div>
<input id="battleships_to_send" style="position: fixed; margin-left: 8%; margin-top: 5%; height: 2%; width: 5%;"></input>
<div id="battleships_max" style="position: fixed; margin-left: 13%; margin-top: 5%; font-size: 22; color: #FFFFFF;">/</div>

<div id="cargoships_textholder" style="position: fixed; margin-left: 1%; margin-top: 7%; font-size: 17; color: #FFFFFF;">Cargoships:</div>
<input id="cargoships_to_send" style="position: fixed; margin-left: 8%; margin-top: 7%; height: 2%; width: 5%;"></input>
<div id="cargoships_max" style="position: fixed; margin-left: 13%; margin-top: 7%; font-size: 22; color: #FFFFFF;">/</div>

<div id="colonizers_textholder" style="position: fixed; margin-left: 1%; margin-top: 9%; font-size: 17; color: #FFFFFF;">Colonizers:</div>
<input id="colonizers_to_send" style="position: fixed; margin-left: 8%; margin-top: 9%; height: 2%; width: 5%;"></input>
<div id="colonizers_max" style="position: fixed; margin-left: 13%; margin-top: 9%; font-size: 22; color: #FFFFFF;">/</div>


<div style="position: fixed; margin-left: 23%; margin-top: 3%; font-size: 22; color: #FFFFFF;">Cargo</div>

<div id="metal_textholder" style="position: fixed; margin-left: 19%; margin-top: 5%; font-size: 17; color: #FFFFFF;">Metal:</div>
<input id="metal_to_send" style="position: fixed; margin-left: 24%; margin-top: 5%; height: 2%; width: 5%;" disabled="true" value="none: attack"></input>
<div id="metal_max" style="position: fixed; margin-left: 29%; margin-top: 5%; font-size: 22; color: #FFFFFF;"></div>

<div id="crystals_textholder" style="position: fixed; margin-left: 19%; margin-top: 7%; font-size: 17; color: #FFFFFF;">Crystals:</div>
<input id="crystals_to_send" style="position: fixed; margin-left: 24%; margin-top: 7%; height: 2%; width: 5%;" disabled="true" value="none: attack"></input>
<div id="crystals_max" style="position: fixed; margin-left: 29%; margin-top: 7%; font-size: 22; color: #FFFFFF;"></div>

<div id="gas_textholder" style="position: fixed; margin-left: 19%; margin-top: 9%; font-size: 17; color: #FFFFFF;">Gas:</div>
<input id="gas_to_send" style="position: fixed; margin-left: 24%; margin-top: 9%; height: 2%; width: 5%;" disabled="true" value="none: attack"></input>
<div id="gas_max" style="position: fixed; margin-left: 29%; margin-top: 9%; font-size: 22; color: #FFFFFF;"></div>


<button style="margin-left: 97%; margin-top: 0%; position: absolute;" onclick="hideSendFleetMenu()"> X </button>
<button style="margin-left: 25%; margin-top: 29%; height: 14%; width: 20%; position: absolute;" onclick="sendFleetConfirm()"> CONFIRM </button>
<div id="fleet_action_text" style="margin-left: 72%; margin-top: 10%; height: 14%; width: 20%; position: absolute; color: #FFFFFF;">Attack a chosen planet<br> then return home</div>
</div>
<!--    ------------------------- -->


</div>
<div id="main_holder" style="width: 100%; height: 100%; margin:0px;"></div>

<script src='dist-web/eosjs-api.js'></script>
<script src='dist-web/eosjs-jsonrpc.js'></script>
<script src='dist-web/eosjs-jssig.js'></script>
<script src="https://cdn.scattercdn.com/file/scatter-cdn/js/latest/scatterjs-core.min.js"></script>
<script src="https://cdn.scattercdn.com/file/scatter-cdn/js/latest/scatterjs-plugin-eosjs.min.js"></script>
<script src="https://cdn.scattercdn.com/file/scatter-cdn/js/latest/scatterjs-plugin-eosjs2.min.js"></script>

<style>


div.planetmode {
  z-index: 10;
}
div.sendfleetmenu {
  z-index: 12;
}
div.planetmode {
  opacity: 0.98;
}

  div.itemholder {border-style: groove;}
  div.itemholder {background-color: #92a8d1;}

  div.sendfleetmenu {border-style: groove;}
  div.sendfleetmenu {background-color: #4F4F4F;}

  div.fleetlist {border-style: outset;}
  div.fleetlist {background-color: #309B92;}

  div.outset {border-style: outset;}
  div.groove {border-style: groove;}
  div.groove {background-color: #92a8d1;}


  div.planetmode {border-style: groove;}
</style>

<script>

  // Setting global variables
  /* **************************************************** */

var activate_selection = true;
var temperatures = [];
var selected_planet_id;
var selected_building_cell_id;

var contract_name = "dexaraniiznx";

var player_name = document.getElementById("player_name_input").value;
var player_exist_div = document.getElementById("player_exists");
//console.log(player_name);

// Main elements that will be modified frequently.

  /*  RESOURCES */
  var planetary_metal = document.getElementById("planetary_metal_res");
  var planetary_crystal = document.getElementById("planetary_crystal_res");
  var planetary_gas = document.getElementById("planetary_gas_res");

  var planetScreen = document.getElementById("planetScreen");
  var planetDescription = document.getElementById("planet_description");
  var planetUpdate = document.getElementById("planet_update");
  var planetPositionXY = document.getElementById("planet_position_xy");
  var planetOwnerName = document.getElementById("planet_owner_name");

  /* ********** BUILDINGS AND STRUCTURES ***************/
  var cellName = document.getElementById("cell_name");
  var cellLevel = document.getElementById("cell_building_level");
  var cellDescription = document.getElementById("cell_description");

  var metal_mine_lvl = document.getElementById("metal_mine_lvl");
  var crystal_mine_lvl = document.getElementById("crystal_mine_lvl");
  var gas_mine_lvl = document.getElementById("gas_mine_lvl");

  var metal_storage_lvl = document.getElementById("metal_storage_lvl");
  var crystal_storage_lvl = document.getElementById("crystal_storage_lvl");
  var gas_storage_lvl = document.getElementById("gas_storage_lvl");

  var assembly_lvl = document.getElementById("assembly_lvl");
  var com_center_lvl = document.getElementById("com_center_lvl");
  var shield_lvl = document.getElementById("shield_lvl");
  /* ************* END BUILDINGS **********************/

  var gridBtn = document.getElementById("switch_to_grid_btn");
  var textBtn = document.getElementById("switch_to_text_btn");

  var active_view = "text"; // For autoupdate to re-init view that is currently selected by user.

// SET TIMER
// Incrementing the "Last updated" counters by 1 each second.
var sec_timer = setInterval(function() {

  var timerNow = planetUpdate.innerHTML;
  timerNow++;
  planetUpdate.innerHTML = timerNow;
              
}, 1000);
// END TIMER

// SET AUTO RE-INIT once per update cycle to be up-to-date with the contract state
// Reinit the selected map section
var cyclic_update_timer = setInterval(function() {

  if(active_view == "text")
  {
    initTextView();
    console.log("reiniting TEXT VIEW");
  }
  else if (active_view == "grid")
  {
    initGridView();
    console.log("reiniting GRID VIEW");
  }
              
}, 90000);
// END TIMER

/* ************************************** */
// End global variables


function spawnPlayer()
{
  console.log("Spawning player " + player_name + " at sector(or planet) " + selected_planet_id);

  // Generate a TX and send it with Scatter
}

  // Super easy color change function.
function selectOn(element) {
  if(activate_selection)
  {
    element.style.background = "PaleGreen";
  }
}
function selectOff(element) {
  if(activate_selection)
  {
    element.style.background = 'transparent';
  }
}
function expand(itr) {
  console.log(itr);
  var el = document.getElementById("div" + itr);
  el.style.height = "250px";
}

function addTaskBuild()
{
  console.log("Adding a building task and transaction for : " + selected_building_cell_id);
}

function showBuildingOverlay(id)
{
  // 0 - com center
  // 1 - assembly
  // 2 - shield
  // 3,4,5 - metal,crystal,gas mines
  // 6,7,8 - metal,crystal,gas storages

  selected_building_cell_id = id;

  // TODO: Assign building names, desctiptions and variables to class
  //       use class instead of hardcoded descriptions and assignments.
  switch (id) {
  case 0:
    cellName.innerHTML = "Command Center";
    cellLevel.innerHTML = "Level: " + com_center_lvl;
    cellDescription.innerHTML = "Command Center is required to send fleets outside of this planet";
    if(com_center_lvl > 0)
    {
      hideBuildBtn();
      hideUpgradeBtn();
    }
    else
    {
      showBuildBtn();
    }
    break;
  case 1:
    cellName.innerHTML = "Assembly";
    cellLevel.innerHTML = "Level: " + assembly_lvl;
    cellDescription.innerHTML = "Assembly is used to craft ships";
    if(assembly_lvl > 0)
    {
      hideBuildBtn();
      hideUpgradeBtn();
    }
    else
    {
      showBuildBtn();
    }
    break;
  case 2:
    cellName.innerHTML = "Shield";
    cellLevel.innerHTML = "Level: " + shield_lvl;
    cellDescription.innerHTML = "Shield will increase the durability of planetary ships";
    if(shield_lvl > 0)
    {
      showUpgradeBtn();
    }
    else
    {
      showBuildBtn();
    }
    break;
  case 3:
    cellName.innerHTML = "Metal Mine";
    cellLevel.innerHTML = "Level: " + metal_mine_lvl;
    cellDescription.innerHTML = "Metal +10/minute";
    if(metal_mine_lvl > 0)
    {
      showUpgradeBtn();
    }
    else
    {
      showBuildBtn();
    }
    break;
  case 4:
    cellName.innerHTML = "Crystal Mine";
    cellLevel.innerHTML = "Level: " + crystal_mine_lvl;
    cellDescription.innerHTML = "Crystals +7/minute";
    if(crystal_mine_lvl > 0)
    {
      showUpgradeBtn();
    }
    else
    {
      showBuildBtn();
    }
    break;
  case 5:
    cellName.innerHTML = "Gas Mine";
    cellLevel.innerHTML = "Level: " + gas_mine_lvl;
    cellDescription.innerHTML = "Gas +5/minute";
    if(gas_mine_lvl > 0)
    {
      showUpgradeBtn();
    }
    else
    {
      showBuildBtn();
    }
    break;
  case 6:
    cellName.innerHTML = "Metal Storage";
    cellLevel.innerHTML = "Level: " + metal_storage_lvl;
    cellDescription.innerHTML = "Metal storage +5000";
    if(metal_storage_lvl > 0)
    {
      showUpgradeBtn();
    }
    else
    {
      showBuildBtn();
    }
    break;
  case 7:
    cellName.innerHTML = "Crystal Storage";
    cellLevel.innerHTML = "Level: " + crystal_storage_lvl;
    cellDescription.innerHTML = "Crystal storage +5000";
    if(crystal_storage_lvl > 0)
    {
      showUpgradeBtn();
    }
    else
    {
      showBuildBtn();
    }
    break;
  case 8:
    cellName.innerHTML = "Gas Storage";
    cellLevel.innerHTML = "Level: " + gas_storage_lvl;
    cellDescription.innerHTML = "Gas storage +5000";
    if(gas_storage_lvl > 0)
    {
      showUpgradeBtn();
    }
    else
    {
      showBuildBtn();
    }
    break;
  }
}

function updatePlayerName()
{
  player_name = document.getElementById("player_name_input").value;

  player_exist_div.innerHTML = "false";
  // TODO: Update with `players` table 
  //       when it will be supported by contract.

  var res = rpc.get_table_rows({
    code: contract_name,
    scope: contract_name,
    table:'sector',
    json: true,        
    limit: 1000,               
    reverse: false
    }).then(function(res){
      for(i=0; i<res.rows.length; i++)
      {
        // Update player existence.
        // If a player controls at least one planet do not suggest him to spawn anymore.
        if(res.rows[i].owner_name == player_name)
        {
          player_exist_div.innerHTML = "true";
        }
      }
    });
}

function showCellInfo()
{
  cellName.style.display = "inline";
  cellLevel.style.display = "inline";
  cellDescription.style.display = "inline";
}

function hideCellInfo()
{
  cellName.style.display = "none";
  cellLevel.style.display = "none";
  cellDescription.style.display = "none";
}

function sendFleetConfirm()
{
  // Sending fleetorder transaction here

  console.log("Fleet order confirmed");
}

function showPlanetaryElements()
{
  showBuildings();
  showFleets();
  showActions();
  showBuildBtn();
  showCellInfo();
}

function hidePlanetaryElements()
{
  hideBuildings();
  hideFleets();
  hideActions();
  hideBuildBtn();
  hideCellInfo();
}

function disableBuildBtns()
{
  var build_btn = document.getElementById("cell_build_btn");
  var upgrade_btn = document.getElementById("cell_upgrade_btn");
  build_btn.disabled = true;
  upgrade_btn.disabled = true;
}

function enableBuildBtns()
{
  var build_btn = document.getElementById("cell_build_btn");
  var upgrade_btn = document.getElementById("cell_upgrade_btn");
  build_btn.disabled = false;
  upgrade_btn.disabled = false;
}

function showBuildBtn()
{
  var build_btn = document.getElementById("cell_build_btn");
  build_btn.style.display = "inline";
  hideUpgradeBtn();
}

function showUpgradeBtn()
{
  var upgrade_btn = document.getElementById("cell_upgrade_btn");
  upgrade_btn.style.display = "inline";
  hideBuildBtn();
}

function hideBuildBtn()
{
  var build_btn = document.getElementById("cell_build_btn");
  build_btn.style.display = "none";
}

function hideUpgradeBtn()
{
  var upgrade_btn = document.getElementById("cell_upgrade_btn");
  upgrade_btn.style.display = "none";
}

function showBuildings()
{
  var el = document.getElementById("buildings");
  el.style.display = "inline";
}

function hideBuildings()
{
  var el = document.getElementById("buildings");
  el.style.display = "none";
}

function showSpawnOption()
{
  var el = document.getElementById("spawn_btn");
  el.style.display = "inline";
}

function hideSpawnOption()
{
  var el = document.getElementById("spawn_btn");
  el.style.display = "none";
}

function checkAllowedCargo()
{
  var el = document.getElementById("order_select");
  var cargo_metal = document.getElementById("metal_to_send");
  var cargo_crystal = document.getElementById("crystals_to_send");
  var cargo_gas = document.getElementById("gas_to_send");
  var action_text = document.getElementById("fleet_action_text");

  if(el.value == 2)
  {
    cargo_metal.disabled = true;
    cargo_crystal.disabled = true;
    cargo_gas.disabled = true;

    cargo_metal.value = "none: attack";
    cargo_crystal.value = "none: attack";
    cargo_gas.value = "none: attack";

    action_text.innerHTML = `Attack a chosen planet<br> then return home`;
  }
  else
  {
    cargo_metal.disabled = false;
    cargo_crystal.disabled = false;
    cargo_gas.disabled = false;

    cargo_metal.value = 0;
    cargo_crystal.value = 0;
    cargo_gas.value = 0;

    if(el.value == 3)
    {
      action_text.innerHTML = `Transport cargo<br> then return home`;
    }
    else if(el.value == 4)
    {
      action_text.innerHTML = `Transport cargo<br> then stay at the destination planet`;
    }
    else if(el.value == 5)
    {
      action_text.innerHTML = `Colonize a chosen planet,<br> fleet will stay at the colonized planet`;
    }
  }
}

function showSendFleetMenu()
{
  // First load the planets owned by current player

  var el = document.getElementById("sendFleetMenu");
  var planets_dropdown = document.getElementById("planet_select");
  var destination_id = document.getElementById("fleet_send_destination");
  planets_dropdown.innerHTML = `<option value="">choose owned planet</option>`;
  destination_id.innerHTML = "planet " + selected_planet_id;

  var res = rpc.get_table_rows({
    code: contract_name,
    scope: contract_name,
    table:'sector',
    json: true,        
    limit: 1000,               
    reverse: false
    }).then(function(res){
      for(i=0; i<res.rows.length; i++)
      {
        console.log(res.rows[i].owner_name);
        if(res.rows[i].owner_name == player_name)
        {
          planets_dropdown.innerHTML += `<option value="` + i + `">Planet ` + i + `</option>`;
        }
      }
    });
  el.style.display = "inline";
}

function hideSendFleetMenu()
{
  var el = document.getElementById("sendFleetMenu");
  el.style.display = "none";
}

function showPlanetFleets()
{
  var planet_id = document.getElementById("planet_select").value;

  var battleships = document.getElementById("battleships_max");
  var cargoships = document.getElementById("cargoships_max");
  var colonizers = document.getElementById("colonizers_max");

  var res = rpc.get_table_rows({
    code: contract_name,
    scope: contract_name,
    table:'sector',
    json: true,        
    limit: 1000,               
    reverse: false
    }).then(function(res){
      for(i=0; i<res.rows.length; i++)
      {
        if(res.rows[i].id == planet_id)
        {
          battleships.innerHTML = "/ " + res.rows[i].planetary_fleet.ships[0];
          cargoships.innerHTML = "/ " + res.rows[i].planetary_fleet.ships[1];
          colonizers.innerHTML = "/ " + res.rows[i].planetary_fleet.ships[2];
        }
      }
    });
}


function showActions()
{
  var el = document.getElementById("actions");
  el.style.display = "inline";
}

function hideActions()
{
  var el = document.getElementById("actions");
  el.style.display = "none";
}

function showFleets()
{
  var el = document.getElementById("fleets");
  el.style.display = "inline";
}

function hideFleets()
{
  var el = document.getElementById("fleets");
  el.style.display = "none";
}

function showPlanet(id)
{
  hideSendFleetMenu();

  if(player_exist_div.innerHTML == "false")
  {
    showSpawnOption();
  }
  else
  {
    hideSpawnOption();
  }

  selected_planet_id = id;

  planetScreen = document.getElementById("planetScreen");
  planetDescription = document.getElementById("planet_description");
  planetUpdate = document.getElementById("planet_update");

  // Use `lower_bound: <id>` to get a single row by ID
  var res = rpc.get_table_rows({
    code: contract_name,
    scope: contract_name,
    table:'sector',
    json: true,
    lower_bound: selected_planet_id,        
    limit: 1,               
    reverse: false
    }).then(function(res){
  
        //pre.textContent += '\n\n' + JSON.stringify(res, null, 2);
        planetary_metal.innerHTML = "0";
        planetary_crystal.innerHTML = "0";
        planetary_gas.innerHTML = "0";
    
          if(res.rows[0].has_planet)
          {

            /* DRAWING A PLANET ************************/
            showPlanetaryElements();

            com_center_lvl = res.rows[0].planetary_buildings[0].level;
            assembly_lvl = res.rows[0].planetary_buildings[1].level;
            shield_lvl = res.rows[0].planetary_buildings[2].level;
            metal_mine_lvl = res.rows[0].planetary_buildings[3].level;
            crystal_mine_lvl = res.rows[0].planetary_buildings[4].level;
            gas_mine_lvl = res.rows[0].planetary_buildings[5].level;
            metal_storage_lvl = res.rows[0].planetary_buildings[6].level;
            crystal_storage_lvl = res.rows[0].planetary_buildings[7].level;
            gas_storage_lvl = res.rows[0].planetary_buildings[8].level;
            showBuildingOverlay(3);
            planetary_metal.innerHTML = res.rows[0].resources[0];
            planetary_crystal.innerHTML = res.rows[0].resources[1];
            planetary_gas.innerHTML = res.rows[0].resources[2];

            planetDescription.innerHTML = "Planet ";
            planetDescription.innerHTML += id;

            planetOwnerName.innerHTML  = "";
            if(res.rows[0].owner_name != "")
            {
              planetOwnerName.innerHTML += res.rows[0].owner_name;
            }
            else
            {
              planetOwnerName.innerHTML += "no owner";
            }

            if(res.rows[0].owner_name == player_name)
            {
              // Enable BUILD and UPGRADE buttons
              // for owned planets.
              enableBuildBtns();
            }
            else
            {
              // Disable BUILD and UPGRADE btns otherwise.
              disableBuildBtns();
            }

            var date = new Date();
            var timestamp = date.getTime(); // Returns data in MICROSECONDS
                                        // Needs to be converted to SECONDS as uint64_t outputs now() in seconds.
            var diff = Math.round(timestamp / 1000) - res.rows[0].last_updated[0];
            planetUpdate.innerHTML = diff;

          }
          else 
          {
            /* EMPTY SECTOR selected *******************/
            hidePlanetaryElements();

            planetDescription.innerHTML = "Empty sector ";
          }

          /* Fill vatiables that are relevant for both sectors and planets */

          planetPositionXY.innerHTML = "[";
          planetPositionXY.innerHTML += res.rows[0].x;
          planetPositionXY.innerHTML += " : ";
          planetPositionXY.innerHTML += res.rows[0].y;
          planetPositionXY.innerHTML += "]";
  });

  planetScreen.style.display = "inline";
}

function hidePlanet(id)
{
  //var el = document.getElementById("planetScreen" + id);
  var el = document.getElementById("planetScreen");
  el.style.display = "none";
  activate_selection = true;
  /*
  var id_hldr = document.getElementById("id_holder");
  var div_id = "div" + id;
  var div_to_hide = document.getElementById(div_id);
  selectOff(div_to_hide);
  */
}


function hideAllPlanets()
{
  for (i=0; i<10000; i++)
  {
    hidePlanet(i);
  }
}

function loadPlanetScreen(id)
{



  var planetScreen = "";
  planetScreen += `<div id="planetScreen` + id + `" class="planetmode" style="width: 80%; height: 80%; background-color: #E2E2E2; position: fixed; margin-left: 10%; margin-top: 3%; display: none;">`

  planetScreen += `<button style="margin-left: 95%; margin-top: 2%; position: relative;" onclick="hidePlanet(` + i + `)"> X </button>`;
  planetScreen += `<div style="margin-left: 4%; margin-top: 10%; position: relative; font-size: 22;"><div style="display: none;" id="idHolder` + i +  `">` + i + `</div><p id="planet_description">Planet ID:  </p></div>`;

  planetScreen += 
  planetScreen += `<div id="buildings` + id + `" class="itemholder" style="width: 96%; height: 35%; position: relative; margin-left: 2%; margin-right: 2%; margin-top: 65%;">`
  planetScreen += `</div>`; // Building cells submenu
  planetScreen += `</div>`; // Main div
  
  var el = document.getElementById("planetary_mode");
  el.innerHTML += planetScreen;
}


function initGridView() {

  content = "";
  active_view = "grid";

  gridBtn.style.display = "none";
  textBtn.style.display = "inline";
  activate_selection = true;

  var res = rpc.get_table_rows({
    code: contract_name,
    scope: contract_name,
    table:'sector',
    json: true,        
    limit: 1000,               
    reverse: false
}).then(function(res){
  
        //pre.textContent += '\n\n' + JSON.stringify(res, null, 2);

      for(i=0; i<res.rows.length;i++)
      {

        //loadPlanetScreen(i);
        
        // For each ROW in the table add a special planet-holder div
        // and fill its content with planetary (or empty sector) variables.
        var div_text = "sector: ";
        var div_style = "groove";
        if(res.rows[i].has_planet)
        {
          div_text = "planet: ";
          div_style = "outset";
        }
        div_text += res.rows[i].id;

        content += `<div id="div` + i + `" onmouseover="selectOn(this)" onclick="showPlanet(` + i + `)" onmouseout="selectOff(this)" style="width: 75px; height: 75px;" class="` + div_style + `">`;
        content += `<div style="margin-top: 5px; margin-left: 5px;" >` + div_text + `</div>`;
        if(res.rows[i].has_planet)
        {
          content += `<img src="planet.png" height="45" width="45" style="margin-bottom: 5px; margin-left: 11px;">`;
        }

        var date = new Date();
        var timestamp = date.getTime(); // Returns data in MICROSECONDS
                                        // Needs to be converted to SECONDS as uint64_t outputs now() in seconds.
        var diff = Math.round(timestamp / 1000) - res.rows[i].last_updated[0];
        temperatures[i] = res.rows[i].temperature;


        content += `</div>`;
      }
      document.getElementById("main_holder").innerHTML = content;
      for (j = 0; j<res.rows.length;j++)
      {
        // Then apply the position

        var mainholder = document.getElementById("main_holder");
        mainholder = mainholder.getBoundingClientRect();
        var offset_x = mainholder.x + 5;
        var offset_y = mainholder.y + 5;
        console.log("X:" + offset_x + " Y:" + offset_y);

        var div_id = "div";
        div_id += j;
        var current_div = document.getElementById(div_id);

        current_div.style.position = "absolute";
        current_div.style.left = res.rows[j].x * 75 + offset_x;
        current_div.style.top = res.rows[j].y * 75 + offset_y;


        //console.log("id " + div_id + " x:" + res.rows[j].x + " y:" + res.rows[j].y);
      }

      updatePlayerName();
  });
}


function initTextView()
{
  content = "";
  active_view = "text";

  gridBtn.style.display = "inline";
  textBtn.style.display = "none";
  activate_selection = true;

  const response = rpc.get_table_rows({
    code: contract_name,
    scope: contract_name,
    table:'sector',
    json: true,        
    limit: 1000,               
    reverse: false
  }).then(async function(res) {


        //pre.textContent += '\n\n' + JSON.stringify(res, null, 2);
      for(i=0; i<res.rows.length;i++)
      {
        
        // For each ROW in the table add a special planet-holder div
        // and fill its content with planetary (or empty sector) variables.
        var div_height = "30px;";
        var div_description_txt = "Empty sector ";
        
        //loadPlanetScreen(i);
        
        if(res.rows[i].has_planet)
        {
          div_description_txt = "Planet ";
          div_height = "70px";
        }
        content += `<div id="div` + i + `" onmouseover="selectOn(this)" onclick="showPlanet(` + i + `)" onmouseout="selectOff(this)" style="margin-bottom: 12px; width: 100%; height: ` + div_height + `" class="outset">`;
        content += `<div style="margin-left: 10px; margin-top: 5px; position: absolute;">` + div_description_txt + "" + res.rows[i].id + `</div>`;
        if(res.rows[i].has_planet)
        {
          content += `<img src="planet.png" height="45" width="45" style="margin-top: 20px; margin-left: 6%; position: absolute;">`;
        }
        content += `<div style="margin-left: 18%; margin-top: 5px; position: absolute;"> X: ` + res.rows[i].x + `</div>`;
        content += `<div style="margin-left: 14%; margin-top: 5px; position: absolute;"> Y: ` + res.rows[i].y + `</div>`;
        if(res.rows[i].has_planet)
        {
          content += `<div style="margin-left: 15%; margin-top: 35px; position: absolute;"> Owner: ` + res.rows[i].owner_name + `</div>`;
          content += `<div style="margin-left: 33%; margin-top: 10px; position: absolute;"> Metal: ` + res.rows[i].resources[0] + `</div>`;
          content += `<div style="margin-left: 33%; margin-top: 28px; position: absolute;"> Crystal: ` + res.rows[i].resources[1] + `</div>`;
          content += `<div style="margin-left: 33%; margin-top: 46px; position: absolute;"> Gas: ` + res.rows[i].resources[2] + `</div>`;
          content += `<div style="margin-left: 45%; margin-top: 10px; position: absolute;"> Battleships: ` + res.rows[i].planetary_fleet.ships[0] + `</div>`;
          content += `<div style="margin-left: 45%; margin-top: 28px; position: absolute;"> Cargoships: ` + res.rows[i].planetary_fleet.ships[1] + `</div>`;
          content += `<div style="margin-left: 45%; margin-top: 46px; position: absolute;"> Colonizers: ` + res.rows[i].planetary_fleet.ships[2] + `</div>`;
        }
        content += `<button style="margin-left: 60%; margin-top: 30px; position: absolute;" onclick="expand(` + i + `)" disabled="true"> Expand </button>`;
        var date = new Date();
        var timestamp = date.getTime(); // Returns data in MICROSECONDS
                                        // Needs to be converted to SECONDS as uint64_t outputs now() in seconds.

        var diff = Math.round(timestamp / 1000) - res.rows[i].last_updated[0];
        content += `<div style="margin-left: 73%; margin-top: 30px; position: absolute;"> Last updated: `+ diff +  ` seconds ago </div>`;
        
        //content += `<div style="margin-left: 73%; margin-top: 5px; position: absolute;"> NOW: `+ timestamp +  ` </div>`;

        content += `</div>`;
      }
      document.getElementById("main_holder").innerHTML = content;


      response_json = await res.rows;
      updatePlayerName();
      return res;

  });
}
</script>


<script>

  // Start the execution of this code
  // on page load.

  let pre = document.getElementsByTagName('pre')[0];
  const defaultPrivateKey = "5JtUScZK2XEp3g9gh7F8bwtPTRAkASmNrrftmx4AxDKD5K4zDnr"; // bob
  const rpc = new eosjs_jsonrpc.JsonRpc('https://api.eosnewyork.io');
  const signatureProvider = new eosjs_jssig.JsSignatureProvider([defaultPrivateKey]);
  const api = new eosjs_api.Api({ rpc, signatureProvider });

  //console.log( rpc.get_account('dexaraniiznx') );   // <<<==== WORKING!

  var content = "";
  var response_json;

  initTextView();


/*

  const response = rpc.get_table_rows({
    code: contract_name,
    scope: contract_name,
    table:'sector',
    json: true,        
    limit: 1000,               
    reverse: false
  }).then(async function(res) {


        //pre.textContent += '\n\n' + JSON.stringify(res, null, 2);
      for(i=0; i<res.rows.length;i++)
      {
        
        // For each ROW in the table add a special planet-holder div
        // and fill its content with planetary (or empty sector) variables.
        var div_height = "30px;";
        var div_description_txt = "Empty sector ";
        
        //loadPlanetScreen(i);
        
        if(res.rows[i].has_planet)
        {
          div_description_txt = "Planet ";
          div_height = "70px";
        }
        content += `<div id="div` + i + `" onmouseover="selectOn(this)" onclick="showPlanet(` + i + `)" onmouseout="selectOff(this)" style="margin-bottom: 12px; width: 100%; height: ` + div_height + `" class="outset">`;
        content += `<div style="margin-left: 10px; margin-top: 5px; position: absolute;">` + div_description_txt + "" + res.rows[i].id + `</div>`;
        if(res.rows[i].has_planet)
        {
          content += `<img src="planet.png" height="45" width="45" style="margin-top: 20px; margin-left: 6%; position: absolute;">`;
        }
        content += `<div style="margin-left: 18%; margin-top: 5px; position: absolute;"> X: ` + res.rows[i].x + `</div>`;
        content += `<div style="margin-left: 14%; margin-top: 5px; position: absolute;"> Y: ` + res.rows[i].y + `</div>`;
        if(res.rows[i].has_planet)
        {
          content += `<div style="margin-left: 15%; margin-top: 35px; position: absolute;"> Owner: ` + res.rows[i].owner_name + `</div>`;
          content += `<div style="margin-left: 33%; margin-top: 10px; position: absolute;"> Metal: ` + res.rows[i].resources[0] + `</div>`;
          content += `<div style="margin-left: 33%; margin-top: 28px; position: absolute;"> Crystal: ` + res.rows[i].resources[1] + `</div>`;
          content += `<div style="margin-left: 33%; margin-top: 46px; position: absolute;"> Gas: ` + res.rows[i].resources[2] + `</div>`;
          content += `<div style="margin-left: 45%; margin-top: 10px; position: absolute;"> Battleships: ` + res.rows[i].planetary_fleet.ships[0] + `</div>`;
          content += `<div style="margin-left: 45%; margin-top: 28px; position: absolute;"> Cargoships: ` + res.rows[i].planetary_fleet.ships[1] + `</div>`;
          content += `<div style="margin-left: 45%; margin-top: 46px; position: absolute;"> Colonizers: ` + res.rows[i].planetary_fleet.ships[2] + `</div>`;
        }
        content += `<button style="margin-left: 60%; margin-top: 30px; position: absolute;" onclick="expand(` + i + `)"> Expand </button>`;
        var date = new Date();
        var timestamp = date.getTime(); // Returns data in MICROSECONDS
                                        // Needs to be converted to SECONDS as uint64_t outputs now() in seconds.

        var diff = Math.round(timestamp / 1000) - res.rows[i].last_updated[0];
        content += `<div style="margin-left: 73%; margin-top: 30px; position: absolute;"> Last updated: `+ diff +  ` seconds ago </div>`;
        
        //content += `<div style="margin-left: 73%; margin-top: 5px; position: absolute;"> NOW: `+ timestamp +  ` </div>`;

        content += `</div>`;
      }
      document.getElementById("main_holder").innerHTML = content;


      response_json = await res.rows;
      return res;
  });

  */

console.log("res variable does not work outside the async rpc.get_table_rows function");
//var tmp = JSON.parse(res);
//console.log(res);

</script>
